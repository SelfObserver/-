# Spring Data Redis
## Redis
redis是一款开源的键值对数据库，企业开发通常采用Redis实现缓存

### Redis持久化机制
RDB(Redis DataBase)、AOF（Append Only File）

#### RDB
RDB持久化是指在指定的时间间隔内将内存中的数据集快照写入磁盘。也是默认的持久化方式，这种方式是就是将内存中数据以快照的方式写入到二进制文件中,默认的文件名为dump.rdb。在我们安装了redis之后，所有的配置都是在redis.conf文件中，里面保存了RDB和AOF两种持久化机制的各种配置。

#### RDB 的优势和劣势
优势

1. RDB文件紧凑，全量备份，非常适合用于进行备份和灾难恢复。
2. 生成RDB文件的时候，redis主进程会fork()一个子进程来处理所有保存工作，主进程不需要进行任何磁盘IO操作。
3. RDB 在恢复大数据集时的速度比 AOF 的恢复速度要快。

劣势

RDB快照是一次全量备份，存储的是内存数据的二进制序列化形式，存储上非常紧凑。当进行快照持久化时，会开启一个子进程专门负责快照持久化，子进程会拥有父进程的内存数据，父进程修改内存子进程不会反应出来，所以在快照持久化期间修改的数据不会被保存，可能丢失数据。

### AOF
全量备份总是耗时的，有时候我们提供一种更加高效的方式AOF，工作机制很简单，redis会将每一个收到的写命令都通过write函数追加到文件中。通俗的理解就是日志记录。

优势
1. AOF可以更好的保护数据不丢失，一般AOF会每隔1秒，通过一个后台线程执行一次fsync操作，最多丢失1秒钟的数据。
2. AOF日志文件没有任何磁盘寻址的开销，写入性能非常高，文件不容易破损。
3. AOF日志文件即使过大的时候，出现后台重写操作，也不会影响客户端的读写。
4. AOF日志文件的命令通过非常可读的方式进行记录，这个特性非常适合做灾难性的误删除的紧急恢复。比如某人不小心用flushall命令清空了所有数据，只要这个时候后台rewrite还没有发生，那么就可以立即拷贝AOF文件，将最后一条flushall命令给删了，然后再将该AOF文件放回去，就可以通过恢复机制，自动恢复所有数据

缺点
1. 对于同一份数据来说，AOF日志文件通常比RDB数据快照文件更大
2. AOF开启后，支持的写QPS会比RDB支持的写QPS低，因为AOF一般会配置成每秒fsync一次日志文件，当然，每秒一次fsync，性能也还是很高的
3. 以前AOF发生过bug，就是通过AOF记录的日志，进行数据恢复的时候，没有恢复一模一样的数据出来。

## redis内存淘汰策略
1. 定期删除
2. 惰性删除

### 缓存击穿、缓存雪崩、缓存穿透
缓存击穿：数据库有数据，缓存没有，这条数据没有人访问过，或者数据刚好失效；重点是热点的key；秒杀商品的key到期失效，请求都到数据库了。对于热点数据的访问：并发的访问数据库。数据被redis“删除”了。

缓存雪崩：缓存雪崩是指，缓存层出现了错误，不能正常工作了。于是所有的请求都会达到存储层，存储层的调用量会暴增，造成存储层也会挂掉的情况。

缓存穿透：用户查询数据库和缓存都没有的数据，这个其实普通用户时做不到的，因为普通用户查询都是我们展示的正常数据；查询没有的数据更多的是避免高并发引起的问题。如果出现大量的查询数据库和缓存中都没有的数据，就是缓存穿透问题



### 内存淘汰策略
1. noeviction：当内存使用超过配置的时候会返回错误，不会驱逐任何键
2. allkeys-lru：加入键的时候，如果过限，首先通过LRU算法驱逐最久没有使用的键
3. volatile-lru：加入键的时候如果过限，首先从设置了过期时间的键集合中驱逐最久没有使用的键
4. allkeys-random：加入键的时候如果过限，从所有key随机删除
5. volatile-random：加入键的时候如果过限，从过期键的集合中随机驱逐
6. volatile-ttl：从配置了过期时间的键中驱逐马上就要过期的键
7. volatile-lfu：从所有配置了过期时间的键中驱逐使用频率最少的键
8. allkeys-lfu：从所有键中驱逐使用频率最少的键

## redis_cluster集群原理
Redis-Cluster采用无中心结构，每个节点保存数据和整个集群状态,每个节点都和其他所有节点连接。
## Jedis
Jedis是Redis官方推出的一款面向java的客户端，提供了很多接口供java语言使用
## Spring data redis
Spring data redis，提供了在spring应用中通过简单的配置访问redis服务，RedisTemplate提供了redis各种操作、异常处理及序列化，支持发布订阅。

## 针对jedis提供了如下功能
1. 连接池自动管理，高度封装的RedisTemplate类
2. 针对jedis客户端中大量的api进行了归类封装，将同一类型操作封装为operation接口
   
   ValueOperations 简单的键值对

   SetOperations  无序集合

   ZSetOperations 有序集合

   HashOperations map类型
   
   ListOperations 列表

3. 提供了对key的bound（绑定）便捷化操作API，进行一系列操作不用再次指定Key，即BoundKeyOperations
   
   BoundValueOperations
   
   BoundSetOperations
   
   BoundListOperations
   
   BoundSetOperations
   
   BoundHashOperations